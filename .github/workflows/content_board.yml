name: Content Board Digest (Itty Bitty Gaming News)

on:
  workflow_dispatch:
  schedule:
    # DST-safe approach:
    # - 02:00 UTC matches 7pm PDT (UTC-7)
    # - 03:00 UTC matches 7pm PST (UTC-8)
    # digest.py includes a guard so it only posts during 7pm PT window and won't double-post.
    - cron: "0 2 * * *"
    - cron: "0 3 * * *"

jobs:
  digest:
    runs-on: ubuntu-latest

    env:
      # Discord
      DISCORD_WEBHOOK_URL: ${{ secrets.CONTENT_BOARD_WEBHOOK_URL }}

      # Digest controls
      DIGEST_WINDOW_HOURS: 24
      DIGEST_TOP_N: 5
      DIGEST_MAX_PER_SOURCE: 1

      # Featured video presentation (Adilo)
      FEATURED_VIDEO_TITLE: Watch today’s Itty Bitty Gaming News
      FEATURED_VIDEO_FALLBACK_URL: https://adilo.bigcommand.com/c/ittybittygamingnews/home
      FEATURED_VIDEO_FALLBACK_ID: K4AxdfCP

      # Adilo API (GitHub Secrets)
      ADILO_PUBLIC_KEY: ${{ secrets.ADILO_PUBLIC_KEY }}
      ADILO_SECRET_KEY: ${{ secrets.ADILO_SECRET_KEY }}
      ADILO_PROJECT_ID: yz8kq5M8

      # YouTube (explicit “same episode” link + title)
      YOUTUBE_FEATURED_URL: https://www.youtube.com/watch?v=gZY2eM2d14k
      YOUTUBE_FEATURED_TITLE: The Remnant Update Is HERE! No Man's Sky's Wildest Feature Yet!

      # DST-safe guard (local time)
      DIGEST_GUARD_TZ: America/Los_Angeles
      DIGEST_GUARD_LOCAL_HOUR: 19
      DIGEST_GUARD_WINDOW_MINUTES: 15

      # UA
      USER_AGENT: IttyBittyGamingNews/Digest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install feedparser requests beautifulsoup4 python-dateutil

      - name: Run digest
        run: |
          python digest.py
